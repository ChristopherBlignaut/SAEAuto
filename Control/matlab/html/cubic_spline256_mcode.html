<pre class="code">
<span class="srcline"><span class="lineno"><a href="94,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T14U3">s0</span>,<span class="var type1" id="S3T14U4">s1</span>,<span class="var type1" id="S4T14U5">s2</span>,<span class="var type1" id="S5T14U6">s3</span>] = cubic_spline(<span class="var type1" id="S6T14U9">x</span>,<span class="var type1" id="S7T14U10">y</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="94,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T6:U7">any(<span class="mxinfo" id="T20:U8"><span class="mxinfo" id="T8:U9">size(<span class="var type1" id="S6T14U19">x</span>)</span> ~= <span class="mxinfo" id="T8:U11">size(<span class="var type1" id="S7T14U22">y</span>)</span></span>)</span> || size(<span class="var type1" id="S6T14U26">x</span>,2) ~= 1</span></span>
<span class="srcline"><span class="lineno"><a href="94,4" id="srcline4"> 4</a></span><span class="line">   error(<span class="string">'inputs x and y must be column vectors of equal length'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="94,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T5:U14"><span class="var type1" id="S11T5U35">n</span> = <span class="mxinfo" id="T5:U16">length(<span class="var type1" id="S6T14U38">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T14:U18"><span class="var type1" id="S13T14U41">h</span> = <span class="mxinfo" id="T14:U20"><span class="mxinfo" id="T14:U21"><span class="var type1" id="S6T14U44">x</span>(<span class="mxinfo" id="T5:U23">2</span>:<span class="var type1" id="S11T5U47">n</span>)</span> - <span class="mxinfo" id="T14:U25"><span class="var type1" id="S6T14U49">x</span>(<span class="mxinfo" id="T5:U27">1</span>:<span class="mxinfo" id="T5:U28"><span class="var type1" id="S11T5U53">n</span>-<span class="mxinfo" id="T5:U30">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T14:U31"><span class="var type1" id="S14T14U57">d</span> = <span class="mxinfo" id="T14:U33">(<span class="mxinfo" id="T14:U34"><span class="mxinfo" id="T14:U35"><span class="var type1" id="S7T14U62">y</span>(<span class="mxinfo" id="T5:U37">2</span>:<span class="var type1" id="S11T5U65">n</span>)</span> - <span class="mxinfo" id="T14:U39"><span class="var type1" id="S7T14U67">y</span>(<span class="mxinfo" id="T5:U41">1</span>:<span class="mxinfo" id="T5:U42"><span class="var type1" id="S11T5U71">n</span>-<span class="mxinfo" id="T5:U44">1</span></span>)</span></span>)./<span class="var type1" id="S13T14U73">h</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T14:U46"><span class="var type1" id="S15T14U76">lower</span> = <span class="mxinfo" id="T14:U48"><span class="var type1" id="S13T14U78">h</span>(<span class="mxinfo" id="T5:U50">2</span>:<span class="mxinfo" id="T5:U51"><span class="mxinfo" id="T5:U52">end</span>-<span class="mxinfo" id="T5:U53">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T14:U54"><span class="var type1" id="S17T14U87">main</span>  = <span class="mxinfo" id="T14:U56">2*(<span class="mxinfo" id="T14:U57"><span class="mxinfo" id="T14:U58"><span class="var type1" id="S13T14U93">h</span>(<span class="mxinfo" id="T5:U60">1</span>:<span class="mxinfo" id="T5:U61"><span class="mxinfo" id="T5:U62">end</span>-<span class="mxinfo" id="T5:U63">1</span></span>)</span> + <span class="mxinfo" id="T14:U64"><span class="var type1" id="S13T14U101">h</span>(<span class="mxinfo" id="T5:U66">2</span>:<span class="mxinfo" id="T5:U67">end</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T14:U68"><span class="var type1" id="S18T14U108">upper</span> = <span class="mxinfo" id="T14:U70"><span class="var type1" id="S13T14U110">h</span>(<span class="mxinfo" id="T5:U72">1</span>:<span class="mxinfo" id="T5:U73"><span class="mxinfo" id="T5:U74">end</span>-<span class="mxinfo" id="T5:U75">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T15:U76"><span class="var type1" id="S19T15U119">T</span> = <span class="mxinfo" id="T15:U78"><span class="mxinfo" id="T15:U79"><span class="mxinfo" id="T15:U80">diag(<span class="var type1" id="S15T14U124">lower</span>,-1)</span> + <span class="mxinfo" id="T15:U82">diag(<span class="var type1" id="S17T14U129">main</span>)</span></span> + <span class="mxinfo" id="T15:U84">diag(<span class="var type1" id="S18T14U132">upper</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo" id="T14:U86"><span class="var type1" id="S21T14U136">rhs</span> = <span class="mxinfo" id="T14:U88">6*(<span class="mxinfo" id="T14:U89"><span class="mxinfo" id="T14:U90"><span class="var type1" id="S14T14U142">d</span>(<span class="mxinfo" id="T5:U92">2</span>:<span class="mxinfo" id="T5:U93">end</span>)</span>-<span class="mxinfo" id="T14:U94"><span class="var type1" id="S14T14U148">d</span>(<span class="mxinfo" id="T5:U96">1</span>:<span class="mxinfo" id="T5:U97"><span class="mxinfo" id="T5:U98">end</span>-<span class="mxinfo" id="T5:U99">1</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T14:U100"><span class="var type1" id="S22T14U157">m</span> = <span class="mxinfo" id="T14:U102"><span class="var type1" id="S19T15U159">T</span>\<span class="var type1" id="S21T14U160">rhs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,22" id="srcline22">22</a></span><span class="line"><span class="comment">% Use natural boundary conditions where second derivative</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,23" id="srcline23">23</a></span><span class="line"><span class="comment">% is zero at the endpoints</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T14:U105"><span class="var type1" id="S22T14U163">m</span> = <span class="mxinfo" id="T14:U107">[ <span class="mxinfo" id="T5:U108">0</span>; <span class="var type1" id="S22T14U168">m</span>; <span class="mxinfo" id="T5:U110">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T14:U111"><span class="var type1" id="S2T14U173">s0</span> = <span class="mxinfo" id="T14:U113"><span class="var type1" id="S7T14U175">y</span>(<span class="mxinfo" id="T5:U115">1</span>:<span class="mxinfo" id="T5:U116"><span class="mxinfo" id="T5:U117">end</span>-<span class="mxinfo" id="T5:U118">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo" id="T14:U119"><span class="var type1" id="S3T14U184">s1</span> = <span class="mxinfo" id="T14:U121"><span class="var type1" id="S14T14U186">d</span> - <span class="mxinfo" id="T14:U123"><span class="mxinfo" id="T14:U124"><span class="var type1" id="S13T14U189">h</span>.*(<span class="mxinfo" id="T14:U126"><span class="mxinfo" id="T14:U127">2*<span class="mxinfo" id="T14:U128"><span class="var type1" id="S22T14U195">m</span>(<span class="mxinfo" id="T5:U130">1</span>:<span class="mxinfo" id="T5:U131"><span class="mxinfo" id="T5:U132">end</span>-<span class="mxinfo" id="T5:U133">1</span></span>)</span></span> + <span class="mxinfo" id="T14:U134"><span class="var type1" id="S22T14U203">m</span>(<span class="mxinfo" id="T5:U136">2</span>:<span class="mxinfo" id="T5:U137">end</span>)</span></span>)</span>/<span class="mxinfo" id="T5:U138">6</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T14:U139"><span class="var type1" id="S4T14U211">s2</span> = <span class="mxinfo" id="T14:U141"><span class="mxinfo" id="T14:U142"><span class="var type1" id="S22T14U214">m</span>(<span class="mxinfo" id="T5:U144">1</span>:<span class="mxinfo" id="T5:U145"><span class="mxinfo" id="T5:U146">end</span>-<span class="mxinfo" id="T5:U147">1</span></span>)</span>/<span class="mxinfo" id="T5:U148">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo" id="T14:U149"><span class="var type1" id="S5T14U224">s3</span> =<span class="mxinfo" id="T14:U151">(<span class="mxinfo" id="T14:U152"><span class="mxinfo" id="T14:U153"><span class="var type1" id="S22T14U229">m</span>(<span class="mxinfo" id="T5:U155">2</span>:<span class="mxinfo" id="T5:U156">end</span>)</span>-<span class="mxinfo" id="T14:U157"><span class="var type1" id="S22T14U235">m</span>(<span class="mxinfo" id="T5:U159">1</span>:<span class="mxinfo" id="T5:U160"><span class="mxinfo" id="T5:U161">end</span>-<span class="mxinfo" id="T5:U162">1</span></span>)</span></span>)./(<span class="mxinfo" id="T14:U163">6*<span class="var type1" id="S13T14U245">h</span></span>)</span></span>;</span></span>
</pre>
